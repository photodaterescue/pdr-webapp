<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- SEO + OPEN GRAPH -->
    <title>Photo Date Rescue ‚Äî Fix Broken Photo Timestamps</title>
    <meta name="description" content="Restore original photo dates in minutes. Perfect for Google Photos downloads & Apple Photos exports. 100% private.">

    <meta property="og:title" content="Photo Date Rescue ‚Äî Fix Broken Photo Timestamps">
    <meta property="og:description" content="Fix broken photo dates from Google Photos and Apple Photos exports. Clean, accurate timeline restoration.">
    <meta property="og:type" content="website">
    <meta property="og:image" content="/static/preview.jpg">

    <!-- Brand theme color -->
    <meta name="theme-color" content="#8c7bff">

    <!-- Premium lavender styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='favicon.png') }}">

    <!-- LemonSqueezy checkout modal -->
    <script src="https://assets.lemonsqueezy.com/lemon.js" defer></script>
</head>
<body>

<!-- ========================= -->
<!-- Site Header               -->
<!-- ========================= -->
<header class="site-header">
    <div class="nav-inner">
        <a href="https://www.photodaterescue.com/#top" class="brand">
            <img
                src="/static/favicon.png"
                alt="Photo Date Rescue logo"
                class="brand-mark"
            />
            <span class="brand-wordmark">Photo Date Rescue</span>
        </a>

        <nav class="primary-nav">
            <a href="https://www.photodaterescue.com/#how-it-works">How it works</a>
            <a href="https://www.photodaterescue.com/#pricing">Pricing</a>
            <a href="https://www.photodaterescue.com/#guides">Guides</a>
            <a href="https://www.photodaterescue.com/#faq">FAQ</a>
            <a href="https://www.photodaterescue.com/#affiliates">Affiliates</a>
            <a href="https://www.photodaterescue.com/#support">Support</a>
        </nav>

        <div class="nav-cta">
            <a class="btn btn-outline lemonsqueezy-button" href="https://pdr.lemonsqueezy.com/buy/c6ede893-fa25-4d63-95cf-17d099dfe3f0?embed=1&enabled=1112455%2C1112460">Get desktop app</a>
        </div>
    </div>
</header>

<!-- ========================= -->
<!-- Main Webapp Content       -->
<!-- ========================= -->
<main class="webapp-content">

    <!-- Hero Section -->
    <div class="hero-section" style="text-align: center; margin-bottom: 32px;">
        <h1 class="app-title" style="font-size: 2.4rem; font-weight: 800; margin-bottom: 8px;">Fix broken photo dates</h1>
        <p class="hero-static-label">
            Fix wrong photo dates from any device, app, or cloud ‚Äî instantly.
        </p>

        <p class="privacy-banner">
            üîí 100% Private ‚Äî web preview is temporary, desktop runs entirely on your own computer.
        </p>
    </div>

        <!-- ========================= -->
        <!-- 2. Upload Card            -->
        <!-- ========================= -->
        <section id="upload-section" class="card upload-card">
            <div id="dropZone" class="dropzone hover-lift">
                <div class="dropzone-inner">
                    <div class="dropzone-icon">‚¨ÜÔ∏è</div>
                    <h3 class="dropzone-title">Drop your ZIP file here</h3>
                    <p class="dropzone-subtitle">or click to browse</p>
                    <p class="dropzone-meta">Maximum file size: 200MB</p>
                </div>
                <input type="file" id="fileInput" accept=".zip" hidden />
            </div>

            <div style="text-align:center; margin-top:18px;">
                <button id="browseBtn" class="btn-primary">Choose ZIP File</button>
            </div>

            <div id="fileInfo" class="fade-in" style="display:none; margin-top:22px;">
                <p><strong>Selected:</strong> <span id="fileName"></span></p>
                <p><strong>Size:</strong> <span id="fileSize"></span></p>
                <button id="uploadBtn" class="submit-btn">Start Processing</button>
            </div>

            <!-- Advanced Settings -->
            <div class="advanced-wrapper" style="text-align:center;">
                <button id="advancedToggle" class="advanced-toggle">
                    <span class="gear-icon">‚öôÔ∏è</span> Advanced settings
                </button>
            </div>

            <div id="advancedSettings" class="advanced-panel">
                <div class="checkbox-row">
                    <input type="checkbox" id="useMtimeFallback" checked>
                    <label for="useMtimeFallback">
                        Allow fallback to Last Modified timestamp when no date is found
                    </label>
                </div>
                <div class="checkbox-row">
                    <input type="checkbox" id="removeDuplicates" checked>
                    <label for="removeDuplicates">
                        Remove exact duplicate files (keep best version only)
                    </label>
                </div>
                <div class="checkbox-row">
                    <input type="checkbox" id="skipNoMetadata">
                    <label for="skipNoMetadata">
                        Remove files with no valid date (exclude from ZIP)
                    </label>
                </div>
            </div>

        </section>

        <!-- ========================= -->
        <!-- 3. Processing Section     -->
        <!-- ========================= -->
        <section id="processing-section" class="card" style="display:none;">
            <h2>Processing Your Photos</h2>

            <!-- Progress bar -->
            <div style="margin-top:20px;">
                <div style="width:100%; background:#e4e1ff; border-radius:999px; height:10px; overflow:hidden;">
                    <div id="progressBar"
                         style="width:0%; height:10px; background:#8c7bff; border-radius:999px; transition:width 0.3s ease;"></div>
                </div>
                <div style="display:flex; justify-content:space-between; margin-top:8px; font-size:0.85rem; color:#514f6c;">
                    <span id="statusText">Uploading...</span>
                    <span id="progressPercent">0%</span>
                </div>
            </div>

            <!-- Step indicators -->
            <div style="margin-top:24px; font-size:0.9rem; color:#3f3f59;">
                <div style="display:flex; align-items:center; gap:10px; margin-bottom:8px;">
                    <span id="step1"
                          style="width:28px; height:28px; border-radius:50%; border:2px solid #d3d3ea; display:flex; align-items:center; justify-content:center; font-weight:600;">
                        1
                    </span>
                    <span>Extracting ZIP file</span>
                </div>
                <div style="display:flex; align-items:center; gap:10px; margin-bottom:8px;">
                    <span id="step2"
                          style="width:28px; height:28px; border-radius:50%; border:2px solid #d3d3ea; display:flex; align-items:center; justify-content:center; font-weight:600;">
                        2
                    </span>
                    <span>Detecting export type (Google / Apple)</span>
                </div>
                <div style="display:flex; align-items:center; gap:10px; margin-bottom:8px;">
                    <span id="step3"
                          style="width:28px; height:28px; border-radius:50%; border:2px solid #d3d3ea; display:flex; align-items:center; justify-content:center; font-weight:600;">
                        3
                    </span>
                    <span>Fixing metadata and timestamps</span>
                </div>
                <div style="display:flex; align-items:center; gap:10px; margin-bottom:8px;">
                    <span id="step4"
                          style="width:28px; height:28px; border-radius:50%; border:2px solid #d3d3ea; display:flex; align-items:center; justify-content:center; font-weight:600;">
                        4
                    </span>
                    <span>Organizing by year</span>
                </div>
                <div style="display:flex; align-items:center; gap:10px;">
                    <span id="step5"
                          style="width:28px; height:28px; border-radius:50%; border:2px solid #d3d3ea; display:flex; align-items:center; justify-content:center; font-weight:600;">
                        5
                    </span>
                    <span>Creating fixed ZIP file</span>
                </div>
                <p class="auto-note">PDR follows a zero-decision workflow ‚Äî nothing to configure, nothing to tune.</p>
            </div>
        </section>

        <!-- ========================= -->
        <!-- 4. Summary Section        -->
        <!-- ========================= -->
        <section id="summary-section" class="card" style="display:none;">
            <h2>Processing Complete!</h2>
            <p>Your photos have been fixed and organized.</p>

            <div class="info-card" style="margin-top:18px;">
                <h2>Summary</h2>
                <p><strong>Export Type:</strong> <span id="exportType"></span></p>
                <p><strong>Total Photos:</strong> <span id="totalFiles"></span></p>
                <p><strong>Fixed (EXIF/XMP):</strong> <span id="fixedFiles"></span></p>
                <p><strong>Restored (filename patterns):</strong> <span id="restoredFiles"></span></p>
                <p><strong>Renamed only (no metadata):</strong> <span id="renamedFiles"></span></p>
                <p><strong>Removed (no valid date):</strong> <span id="skippedFiles"></span></p>
                <p><strong>Duplicates removed:</strong> <span id="duplicatesRemoved"></span></p>
            </div>

            <!-- Skipped files notice -->
<div id="skippedFilesNotice" class="notice-card notice-info" style="display:none; margin-top:18px;">
    <p class="notice-title">Some files were skipped</p>
    <p class="notice-text">This demo processes photos only. Videos and documents remain unchanged in your original ZIP.</p>
</div>

<!-- Duplicate summary (Option 1 UI) -->
<div id="duplicateSummaryContainer" class="info-card duplicate-summary-card" style="display:none; margin-top:18px;">
    <div class="duplicate-summary-header">
        <div>
            <h3 class="duplicate-summary-title">Exact duplicates removed</h3>
            <p class="duplicate-summary-count">
                <span id="duplicateCountLabel">0</span> file(s) removed as exact duplicates.
            </p>
            <p class="duplicate-zip-note">
                Full duplicate report included in your ZIP download
                (<code>duplicates_report.txt</code>).
            </p>
        </div>
    </div>
</div>


            <!-- Primary button -->
            <button id="downloadBtn"
                    class="btn-primary w-full">
                Download Fixed Photos
            </button>

            <!-- Secondary button -->
            <button id="resetBtn"
                    class="btn-secondary w-full mt-3">
                Process Another ZIP
            </button>

            <p style="margin-top:10px; font-size:0.8rem; text-align:center; color:#3b3954;">
                Files from the web preview are processed temporarily and deleted automatically after your download completes.
            </p>
        </section>

        <!-- ========================= -->
        <!-- 5. Error Section          -->
        <!-- ========================= -->
        <section id="error-section" class="card error-card" style="display:none;">
            <p class="error-title" id="errorTitle">We couldn't process this file</p>
            <p class="error-message" id="errorMessage"></p>
            <p class="error-hint" id="errorHint" style="display:none;"></p>
            <button id="errorResetBtn" class="btn-primary error-btn">
                Try Again
            </button>
        </section>

</main>

<!-- ========================= -->
<!-- How the Web App Works     -->
<!-- ========================= -->
<section class="section section-how-it-works">
  <div class="section-inner">
    <h2 class="section-title section-title-center">How it works</h2>
    <p class="section-tagline section-tagline-center">Simple 3-step guide to fixing your photo dates</p>

    <div class="step-grid">
      <!-- Card 1 -->
      <div class="step-card">
        <div class="step-number">1</div>
        <h3>Upload your ZIP file</h3>
        <p>Works with Google Photos, Apple Photos, WhatsApp, Messenger & device backups ‚Äî as long as they're in a ZIP.</p>
        <ul>
          <li>For normal folders instead of ZIPs, the <strong>desktop app</strong> handles everything.</li>
        </ul>
      </div>

      <!-- Card 2 -->
      <div class="step-card">
        <div class="step-number">2</div>
        <h3>Let PDR do the work automatically</h3>
        <p>No settings, no decisions ‚Äî just wait for the progress bar:</p>
        <ul>
          <li>Extracting your ZIP</li>
          <li>Detecting export type (Google / Apple)</li>
          <li>Fixing metadata & timestamps</li>
          <li>Organising everything into clean year folders</li>
          <li>Creating your perfectly fixed ZIP</li>
        </ul>
      </div>

      <!-- Card 3 -->
      <div class="step-card">
        <div class="step-number">3</div>
        <h3>Download your new, clean library</h3>
        <p>Click Download, unzip the file, and enjoy perfectly named photos in true chronological order.</p>
        <ul>
          <li>You'll also get a <strong>Summary Report</strong> (totals, export types, fixed vs. renamed, etc.)</li>
          <li>A detailed log file is included inside the ZIP for full transparency.</li>
        </ul>
      </div>
    </div>
  </div>
</section>

<!-- ========================= -->
<!-- Pricing Section           -->
<!-- ========================= -->

<section id="pricing" class="section section-pricing">
  <div class="section-inner">
    <h2 class="section-title section-title-center">PDR Pricing</h2>
    <p class="section-tagline section-tagline-center">
      Start with the free web demo. Upgrade when you're ready to restore
      everything.
    </p>

    <div class="pricing-grid">
      <!-- Free -->
      <article class="pricing-card">
        <h3 class="plan-name">Free</h3>
        <p class="plan-price">$0</p>
        <p class="plan-period"><strong>Web Demo Version</strong></p>
        <ul class="plan-features">
          <li>Fix photo dates (up to 200&nbsp;MB ZIP)</li>
          <li>Works with Google Takeout, iCloud, WhatsApp, Messenger</li>
          <li>Smart duplicate removal</li>
          <li>Clean timeline renaming (photos only)</li>
          <li>ZIP upload &amp; instant preview</li>
          <li>Photos only ‚Äî videos &amp; documents skipped</li>
        </ul>
        <p class="plan-period" style="margin-top: auto; font-size: 0.9rem;"><strong>Use on: Web demo</strong></p>
        <a
          class="btn btn-primary btn-card"
          href="https://webapp.photodaterescue.com"
          target="_blank"
          rel="noopener"
        >
          Free web demo
        </a>
      </article>

      <!-- Monthly -->
      <article class="pricing-card">
        <h3 class="plan-name">Monthly</h3>
        <p class="plan-price">$16.99</p>
        <p class="plan-period"><strong>Desktop Version</strong></p>
        <ul class="plan-features">
          <li>Everything in Free, plus:</li>
          <li>Fix dates for photos and videos</li>
          <li>Restore missing "Date Taken" timestamps</li>
          <li>Fully repair social media exports (WhatsApp, Messenger, Instagram, Snapchat)</li>
          <li>Organise unlimited folders, ZIPs, and libraries</li>
          <li>Smart renaming for complete clean timelines</li>
          <li>Safe processing ‚Äî originals untouched</li>
        </ul>
        <p class="plan-period" style="margin-top: auto; font-size: 0.9rem;"><strong>Use on up to 3 devices</strong></p>
        <a class="btn btn-outline btn-card lemonsqueezy-button" href="https://pdr.lemonsqueezy.com/buy/ea41d61a-40b5-4be1-9130-2a0c3ee94ebb?embed=1&enabled=1112455%2C1112460">
          Buy monthly
        </a>
      </article>

      <!-- Yearly -->
      <article class="pricing-card pricing-card--yearly">
        <div class="plan-badge">Best value</div>
        <h3 class="plan-name">Yearly</h3>
        <p class="plan-price">$99</p>
        <p class="plan-period"><strong>Desktop Version</strong></p>
        <ul class="plan-features">
          <li>Everything in Monthly, plus:</li>
          <li>Ideal for large or growing libraries</li>
          <li>Handles big collections (tens of GBs+)</li>
          <li>Receive new features as they release</li>
        </ul>
        <p class="plan-period" style="margin-top: auto; font-size: 0.9rem;"><strong>Use on up to 3 devices</strong></p>
        <a class="btn btn-outline btn-card lemonsqueezy-button" href="https://pdr.lemonsqueezy.com/buy/c6ede893-fa25-4d63-95cf-17d099dfe3f0?embed=1&enabled=1112455%2C1112460">
          Buy yearly
        </a>
      </article>

      <!-- Lifetime -->
      <article class="pricing-card pricing-card--lifetime">
        <div class="ripple-background">
          <div class="ripple-ring ring-1"></div>
          <div class="ripple-ring ring-2"></div>
          <div class="ripple-ring ring-3"></div>
          <div class="ripple-ring ring-4"></div>
        </div>
        <h3 class="plan-name">Lifetime</h3>
        <p class="plan-price">$199</p>
        <p class="plan-period"><strong>Desktop Version</strong></p>
        <ul class="plan-features">
          <li>Everything in Yearly, plus:</li>
          <li>Permanent access ‚Äî one-time purchase</li>
        </ul>
        <p class="lifetime-note" style="margin-top: auto;">
          <strong>Available only after one successful Monthly or Yearly payment.</strong>
        </p>
        <p class="plan-period" style="font-size: 0.9rem;"><strong>Best long-term savings</strong></p>
        <p class="plan-period" style="font-size: 0.9rem;"><strong>Use on up to 10 devices</strong></p>
        <a class="btn btn-disabled btn-card" style="pointer-events: none; opacity: 0.6;">
          Unlock after first billing cycle
        </a>
      </article>
    </div>

    <p class="hero-footnote">
      <strong>Web demo: ZIPs up to 200&nbsp;MB. Desktop app: unlimited folders,
      ZIPs and devices.</strong>
    </p>
  </div>
</section>

<!-- ========================= -->
<!-- Duplicate full-list modal -->
<!-- ========================= -->
<div id="duplicateModal" class="modal" aria-hidden="true">
    <div id="duplicateModalBackdrop" class="modal-backdrop"></div>
    <div class="modal-dialog">
        <div class="modal-header">
            <h3>Duplicate files removed</h3>
            <button id="closeDuplicateModal" class="modal-close" aria-label="Close duplicate list">&times;</button>
        </div>
        <pre id="duplicateModalList" class="duplicate-modal-list">
No duplicates were removed from this ZIP.
        </pre>
    </div>
</div>

<!-- ========================= -->
<!-- 9. JavaScript Logic       -->
<!-- ========================= -->
    
    <script>
        
    // =======================
    // ELEMENT REFERENCES
    // =======================
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const browseBtn = document.getElementById('browseBtn');
    const fileInfo = document.getElementById('fileInfo');
    const uploadBtn = document.getElementById('uploadBtn');

    const uploadSection = document.getElementById('upload-section');
    const processingSection = document.getElementById('processing-section');
    const summarySection = document.getElementById('summary-section');
    const errorSection = document.getElementById('error-section');

    const resetBtn = document.getElementById('resetBtn');
    const errorResetBtn = document.getElementById('errorResetBtn');

    const advancedToggle = document.getElementById('advancedToggle');
    const advancedSettings = document.getElementById('advancedSettings');

    const useMtimeFallback = document.getElementById('useMtimeFallback');
    const skipNoMetadata = document.getElementById('skipNoMetadata');
    const removeDuplicates = document.getElementById('removeDuplicates');

    // Duplicate summary UI (simplified)
    const duplicateSummaryContainer = document.getElementById('duplicateSummaryContainer');
    const duplicateCountLabel = document.getElementById('duplicateCountLabel');
    const duplicateNote = document.getElementById('duplicateNote');
    const duplicateListEl = document.getElementById('duplicateList');

    let selectedFile = null;
    let downloadBlob = null;


    // =======================
    // SECTION CONTROL
    // =======================
    function showSection(section) {
        uploadSection.style.display = section === 'upload' ? 'block' : 'none';
        processingSection.style.display = section === 'processing' ? 'block' : 'none';
        summarySection.style.display = section === 'summary' ? 'block' : 'none';
        errorSection.style.display = section === 'error' ? 'block' : 'none';
    }
    showSection('upload');


    // =======================
    // ADVANCED SETTINGS TOGGLE
    // =======================
    advancedToggle.addEventListener('click', () => {
        advancedSettings.classList.toggle('advanced-panel-open');
    });


    // =======================
    // FILE INPUT
    // =======================
    browseBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        fileInput.click();
    });

    dropZone.addEventListener('click', () => fileInput.click());

    dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.classList.add('dropzone-hover');
    });

    dropZone.addEventListener('dragleave', () => {
        dropZone.classList.remove('dropzone-hover');
    });

    dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.classList.remove('dropzone-hover');

        if (e.dataTransfer.files.length > 0) {
            const file = e.dataTransfer.files[0];

            if (!file.name.toLowerCase().endsWith('.zip')) {
                alert("Please upload a .zip file.");
                return;
            }

            if (!checkZipLimit(file)) return;
            handleFileSelect(file);
        }
    });

    fileInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
            const file = e.target.files[0];
            if (!checkZipLimit(file)) return;
            handleFileSelect(file);
        }
    });

    function handleFileSelect(file) {
        selectedFile = file;
        document.getElementById('fileName').textContent = file.name;
        document.getElementById('fileSize').textContent = formatFileSize(file.size);
        fileInfo.style.display = 'block';
    }

    function formatFileSize(bytes) {
        if (bytes < 1024) return bytes + ' B';
        if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';
        if (bytes < 1024 * 1024 * 1024) return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
        return (bytes / (1024 * 1024 * 1024)).toFixed(2) + ' GB';
    }


    // =======================
    // UPLOAD 200MB ZIP LIMIT (front-end)
    // =======================
        function checkZipLimit(file) {
            const MAX_MB = 200;
            if (file.size > MAX_MB * 1024 * 1024) {
                showError(
                    "The web demo supports ZIPs up to 200 MB.<br>Your upload was too large ‚Äî please reduce the ZIP size or try a smaller folder.",
                    "For large libraries, use the <strong>Desktop Version</strong> (supports unlimited size)."
                );
                return false;
            }
            return true;
        }



    // =======================
    // UPLOAD + PROCESS
    // =======================
    uploadBtn.addEventListener('click', () => {
        if (!selectedFile) return;

        // Align with 200MB front-end rule
        const MAX_MB = 200;
        if (selectedFile.size > MAX_MB * 1024 * 1024) {
            showError(
                "The web demo supports ZIPs up to 200 MB.<br>Your upload was too large ‚Äî please reduce the ZIP size or try a smaller folder.",
                "For large libraries, use the <strong>Desktop Version</strong> (supports unlimited size)."
            );
            return;
        }

        showSection('processing');
        updateProgress(10, 'Uploading...');

        const formData = new FormData();
        formData.append('file', selectedFile);
        formData.append('use_mtime_fallback', useMtimeFallback.checked ? 'true' : 'false');
        formData.append('skip_no_metadata', skipNoMetadata.checked ? 'true' : 'false');
        formData.append('remove_duplicates', removeDuplicates.checked ? 'true' : 'false');

        const xhr = new XMLHttpRequest();

        xhr.upload.addEventListener('progress', (e) => {
            if (e.lengthComputable) {
                const pct = Math.round((e.loaded / e.total) * 30);
                updateProgress(pct, 'Uploading...');
            }
        });

        xhr.addEventListener('load', () => {
            if (xhr.status === 200) {
                updateStep(1, true);
                updateProgress(40, 'Extracting...');

                setTimeout(() => {
                    updateStep(2, true);
                    updateProgress(60, 'Fixing metadata...');
                }, 400);

                setTimeout(() => {
                    updateStep(3, true);
                    updateProgress(80, 'Organizing...');
                }, 900);

                setTimeout(() => {
                    updateStep(4, true);
                    updateProgress(95, 'Packaging...');
                }, 1400);

                setTimeout(() => {
                    updateStep(5, true);
                    updateProgress(100, 'Complete!');

                    const exportType = xhr.getResponseHeader('X-Export-Type');
                    const totalFiles = xhr.getResponseHeader('X-Total-Files');
                    const fixedFiles = xhr.getResponseHeader('X-Fixed-Files');
                    const restoredFiles = xhr.getResponseHeader('X-Restored-Files');
                    const renamedFiles = xhr.getResponseHeader('X-Renamed-Files');
                    const skippedFiles = xhr.getResponseHeader('X-Skipped-Files');
                    const duplicatesRemoved = xhr.getResponseHeader('X-Duplicates-Removed');

                    downloadBlob = xhr.response;

                    showSummary(
                        exportType,
                        totalFiles,
                        fixedFiles,
                        restoredFiles,
                        renamedFiles,
                        skippedFiles,
                        duplicatesRemoved
                    );
                }, 1900);

            } else {
                try {
                    const err = JSON.parse(xhr.responseText);
                    showError(err.error || 'Processing failed');
                } catch {
                    showError('Processing failed');
                }
            }
        });

        xhr.addEventListener('error', () => showError('Network error ‚Äî the connection was interrupted. Try a smaller ZIP file (under 50MB).'));
        xhr.addEventListener('timeout', () => showError('Upload timed out ‚Äî the file may be too large for the web version. Try a smaller ZIP.'));
        xhr.addEventListener('abort', () => showError('Upload was cancelled.'));

        xhr.open('POST', '/upload');
        xhr.timeout = 600000; // 10 minute timeout
        xhr.responseType = 'blob';
        xhr.send(formData);
    });


    // =======================
    // PROGRESS + STEPS
    // =======================
    function updateProgress(percent, text) {
        document.getElementById('progressBar').style.width = percent + '%';
        document.getElementById('progressPercent').textContent = percent + '%';
        document.getElementById('statusText').textContent = text;
    }

    function updateStep(step, active) {
        const el = document.getElementById('step' + step);
        if (active && el) {
            el.style.backgroundColor = '#8c7bff';
            el.style.color = '#fff';
            el.style.borderColor = '#8c7bff';
        }
    }


    // =======================
    // SUMMARY SCREEN
    // =======================
    function showSummary(exportType, total, fixed, restored, renamed, skipped, duplicatesRemoved) {
        showSection('summary');

        const exportTypeEl = document.getElementById('exportType');
        exportTypeEl.textContent =
            exportType === 'google_takeout' ? 'Google Photos Download'
          : exportType === 'apple_photos' ? 'Apple Photos Export (Unmodified Originals)'
          : exportType || 'Unknown export';

        document.getElementById('totalFiles').textContent = total || '0';
        document.getElementById('fixedFiles').textContent = fixed || '0';
        document.getElementById('restoredFiles').textContent = restored || '0';
        document.getElementById('renamedFiles').textContent = renamed || '0';
        document.getElementById('skippedFiles').textContent = skipped || '0';
        document.getElementById('duplicatesRemoved').textContent = duplicatesRemoved || '0';

        const dupCount = parseInt(duplicatesRemoved || "0", 10);
        const skippedCount = parseInt(skipped || "0", 10);

        // Show skipped files notice if any files were skipped
        const skippedNotice = document.getElementById('skippedFilesNotice');
        if (skippedCount > 0 && skippedNotice) {
            skippedNotice.style.display = 'block';
        } else if (skippedNotice) {
            skippedNotice.style.display = 'none';
        }

        if (dupCount > 0 && duplicateSummaryContainer) {
            duplicateSummaryContainer.style.display = 'block';
            if (duplicateCountLabel) {
                duplicateCountLabel.textContent = dupCount.toString();
            }
        } else if (duplicateSummaryContainer) {
            duplicateSummaryContainer.style.display = 'none';
        }
    }


    // =======================
    // ERROR SCREEN
    // =======================
    function showError(msg, hint) {
        const errorTitle = document.getElementById('errorTitle');
        const errorMessage = document.getElementById('errorMessage');
        const errorHint = document.getElementById('errorHint');
        
        errorMessage.innerHTML = msg || 'Unknown error';
        
        if (hint) {
            errorHint.innerHTML = hint;
            errorHint.style.display = 'block';
        } else {
            errorHint.style.display = 'none';
        }
        
        showSection('error');
    }


    // =======================
    // DOWNLOAD ZIP
    // =======================
    document.getElementById('downloadBtn').addEventListener('click', () => {
        if (downloadBlob) {
            const url = URL.createObjectURL(downloadBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'fixed_photos.zip';
            document.body.appendChild(a);
            a.click();
            a.remove();
            URL.revokeObjectURL(url);
        }
    });


    // =======================
    // RESET
    // =======================
    function resetForm() {
        selectedFile = null;
        downloadBlob = null;

        fileInput.value = '';
        fileInfo.style.display = 'none';

        updateProgress(0, 'Uploading...');
        for (let i = 1; i <= 5; i++) {
            const el = document.getElementById('step' + i);
            if (el) {
                el.style.backgroundColor = '';
                el.style.color = '';
                el.style.borderColor = '#d3d3ea';
            }
        }

        showSection('upload');
    }

    resetBtn.addEventListener('click', resetForm);
    errorResetBtn.addEventListener('click', resetForm);

    </script>

<!-- ========================= -->
<!-- Site Footer               -->
<!-- ========================= -->
<footer class="site-footer">
    <div class="footer-inner">
        <p>&copy; 2025 Photo Date Rescue Ltd. All rights reserved.</p>
        <nav class="footer-nav">
            <a href="https://www.photodaterescue.com/#top" class="footer-logo">
                <img src="{{ url_for('static', filename='favicon.png') }}" alt="PDR" class="footer-logo-img">
                <span class="footer-logo-text">PDR</span>
            </a>
            <span>&middot;</span>
            <a href="https://www.photodaterescue.com/#how-it-works">How it works</a>
            <span>&middot;</span>
            <a href="https://www.photodaterescue.com/#pricing">Pricing</a>
            <span>&middot;</span>
            <a href="https://www.photodaterescue.com/#guides">Guides</a>
            <span>&middot;</span>
            <a href="https://www.photodaterescue.com/#faq">FAQ</a>
            <span>&middot;</span>
            <a href="https://www.photodaterescue.com/#affiliates">Affiliates</a>
        </nav>
        <nav class="footer-legal">
            <a href="https://photodaterescue.com/legal/terms.html">Terms of Service</a>
            <span>¬∑</span>
            <a href="https://photodaterescue.com/legal/refund-policy.html">Refund Policy</a>
            <span>¬∑</span>
            <a href="https://photodaterescue.com/legal/privacy.html">Privacy Policy</a>
        </nav>
    </div>
</footer>

</body>
</html>
