<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta property="og:title" content="Photo Date Rescue ‚Äî Fix Broken Photo Timestamps">
    <meta property="og:description" content="Restore original photo dates in minutes. Perfect for Google Photos downloads & Apple Photos exports. 100% private.">
    <meta property="og:type" content="website">
    <meta property="og:image" content="/static/preview.jpg">
    <meta name="theme-color" content="#8c7bff">

    <title>Photo Date Rescue ‚Äî Fix Broken Photo Timestamps</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='favicon.png') }}">
</head>

<body>
<div class="page">

    <header class="header">
        <h1 class="app-title">Photo Date Rescue</h1>
        <p class="app-subtitle">
            Fix broken photo dates in Google Photos downloads &amp; Apple Photos exports.
        </p>
        <p class="mission">
            Turn years of jumbled cloud downloads into a clean, chronological photo archive in minutes ‚Äì without renaming files by hand.
        </p>
        <p class="privacy-banner">
            üîí 100% Private ‚Äì Files processed in-browser and deleted immediately
        </p>
    </header>

    <main class="main">

        <!-- Upload card -->
        <section class="card upload-card">

            <!-- FORM WRAPS EVERYTHING (FIXED) -->
            <form id="uploadForm" method="post" 
                  action="{{ url_for('upload_file') }}" 
                  enctype="multipart/form-data">

                <div class="dropzone" id="dropzone">
                    <div class="dropzone-inner">
                        <div class="dropzone-icon">‚òÅÔ∏è</div>
                        <h2 class="dropzone-title">Drop your ZIP file here</h2>
                        <p class="dropzone-subtitle">or click to browse</p>

                        <button type="button" class="btn-primary" id="chooseFileBtn">
                            Choose ZIP File
                        </button>

                        <p class="dropzone-meta">
                            Web upload limit: ~100 MB per ZIP (Beta).  
                            Larger archives supported in upcoming desktop version.
                        </p>

                        <!-- REAL FILE INPUT MUST REMAIN AS NAME="zip_file" -->
                        <input type="file" id="fileInput" name="zip_file" accept=".zip" hidden />
                    </div>
                </div>

                <!-- Advanced settings -->
                <div class="advanced-wrapper">
                    <button type="button" class="advanced-toggle" id="advancedToggle">
                        Advanced settings <span class="gear-icon">‚öôÔ∏è</span>
                    </button>

                    <div class="advanced-panel" id="advancedPanel">
                        <label class="checkbox-row">
                            <input type="checkbox" id="useMtimeFallback" checked />
                            <span>Allow fallback to Last Modified timestamp when no date is found (recommended)</span>
                        </label>

                        <label class="checkbox-row">
                            <input type="checkbox" id="removeNoDateFiles" />
                            <span>Remove files with no valid date (exclude from ZIP)</span>
                        </label>
                    </div>
                </div>

                <!-- Hidden fields -->
                <input type="hidden" name="use_mtime_fallback" id="useMtimeField" value="true">
                <input type="hidden" name="remove_no_date_files" id="removeNoDateField" value="false">

                <!-- Submit button -->
                <button type="submit" class="submit-btn" id="startProcessingBtn" disabled>
                    Start Processing
                </button>
            </form>
        </section>


        <!-- HOW IT WORKS -->
        <section class="card info-card">
            <h2>How it works</h2>
            <ol class="how-list">
                <li>
                    Upload your 
                    <span class="tooltip-label">Google Photos Download
                        <span class="tooltip-icon">‚ìò
                            <span class="tooltip-text">
                                Also known as: Google Photos backup, Google Photos archive, Google Takeout ZIP.
                            </span>
                        </span>
                    </span>
                    or
                    <span class="tooltip-label">Apple Photos Export (Unmodified Originals)
                        <span class="tooltip-icon">‚ìò
                            <span class="tooltip-text">
                                Also known as: Apple Photos library export, iCloud Photos download, Photos.app export.
                            </span>
                        </span>
                    </span>
                    ZIP file.
                </li>
                <li>We automatically detect the export type and parse metadata.</li>
                <li>Original timestamps are restored to EXIF data whenever possible.</li>
                <li>Photos are organized into folders by year with clean filenames.</li>
                <li>Download your fixed ZIP ‚Äì all files are deleted immediately after.</li>
            </ol>
        </section>

        <!-- PRIVACY -->
        <section class="card info-card privacy-card">
            <h2>Privacy Guarantee</h2>
            <p>Your photos are processed entirely on our server with temporary storage only.</p>
            <p>All files are automatically deleted as soon as your download completes.</p>
            <p>We never store, view, or share your photos. Zero retention. Zero tracking.</p>
        </section>

        <!-- FAQ -->
        <section class="card info-card faq-card">
            <h2>Frequently Asked Questions</h2>

            <p><strong>What happens if a photo has no date?</strong></p>
            <p>If enabled, we fall back to the Last Modified timestamp to keep your library chronological.</p>

            <p><strong>Will filenames change?</strong></p>
            <p>Only if metadata provides a timestamp. Fallback dates do <em>not</em> change filenames.</p>

            <p><strong>Are my files ever stored?</strong></p>
            <p>No. Everything is processed in-memory and deleted instantly.</p>

            <p><strong>Is this safe for big libraries?</strong></p>
            <p>Yes ‚Äî but the browser upload limit is ~100MB. Multi-GB archives will be supported in the desktop app.</p>
        </section>

    </main>
</div>


<script>
// Advanced settings toggle
const advancedToggle = document.getElementById('advancedToggle');
const advancedPanel  = document.getElementById('advancedPanel');

advancedToggle.addEventListener('click', () => {
    advancedPanel.classList.toggle('advanced-panel-open');
});

// Upload & drag/drop wiring
const dropzone  = document.getElementById('dropzone');
const fileInput = document.getElementById('fileInput');
const chooseBtn = document.getElementById('chooseFileBtn');
const startBtn  = document.getElementById('startProcessingBtn');

const useMtimeCheckbox    = document.getElementById('useMtimeFallback');
const removeNoDateCheckbox = document.getElementById('removeNoDateFiles');
const useMtimeField       = document.getElementById('useMtimeField');
const removeNoDateField   = document.getElementById('removeNoDateField');

function enableSubmitIfFileChosen() {
    startBtn.disabled = !(fileInput.files.length > 0);
}

// click to open file picker
chooseBtn.addEventListener('click', () => fileInput.click());

// manual selection
fileInput.addEventListener('change', enableSubmitIfFileChosen);

// dragover
dropzone.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropzone.classList.add('dropzone-hover');
});

// dragleave
dropzone.addEventListener('dragleave', () => {
    dropzone.classList.remove('dropzone-hover');
});

// drop
dropzone.addEventListener('drop', (e) => {
    e.preventDefault();
    dropzone.classList.remove('dropzone-hover');

    if (e.dataTransfer.files && e.dataTransfer.files[0]) {
        fileInput.files = e.dataTransfer.files;
        enableSubmitIfFileChosen();
    }
});

// checkbox ‚Üí hidden input sync
useMtimeCheckbox.addEventListener('change', () => {
    useMtimeField.value = useMtimeCheckbox.checked ? 'true' : 'false';
});
removeNoDateCheckbox.addEventListener('change', () => {
    removeNoDateField.value = removeNoDateCheckbox.checked ? 'true' : 'false';
});
</script>

</body>
</html>
